local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")

local LocalPlayer = Players.LocalPlayer
local detectionDistance = 33.5
local isSpamming = false
local spamConnection

-- Função para verificar se há algum player próximo
local function isPlayerNearby()
    if not LocalPlayer.Character or not LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
        return false
    end
    
    local myPosition = LocalPlayer.Character.HumanoidRootPart.Position
    
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            local distance = (player.Character.HumanoidRootPart.Position - myPosition).Magnitude
            if distance <= detectionDistance then
                return true
            end
        end
    end
    
    return false
end

-- Função para verificar se GameBall existe e é Really Red
local function isGameBallRed()
    local gameBall = workspace:FindFirstChild("GameBall")
    if gameBall and gameBall:IsA("BasePart") then
        return gameBall.BrickColor == BrickColor.new("Really red")
    end
    return false
end

-- Função para verificar se GameBall está próximo
local function isGameBallNearby()
    if not LocalPlayer.Character or not LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
        return false
    end
    
    local gameBall = workspace:FindFirstChild("GameBall")
    if gameBall and gameBall:IsA("BasePart") then
        local myPosition = LocalPlayer.Character.HumanoidRootPart.Position
        local distance = (gameBall.Position - myPosition).Magnitude
        return distance <= detectionDistance
    end
    
    return false
end

-- Função para enviar o código
local function fireCode()
    local args = {
        [1] = 2.933813859058389e+76
    }
    
    local remote = ReplicatedStorage.TS.GeneratedNetworkRemotes:FindFirstChild("RE_4.6848415795802784e+76")
    if remote then
        remote:FireServer(unpack(args))
    end
end

-- Função para iniciar o spam
local function startSpamming()
    if isSpamming then return end
    
    isSpamming = true
    print("Spam ativado!")
    
    spamConnection = RunService.Heartbeat:Connect(function()
        fireCode()
    end)
end

-- Função para parar o spam
local function stopSpamming()
    if not isSpamming then return end
    
    isSpamming = false
    print("Spam desativado!")
    
    if spamConnection then
        spamConnection:Disconnect()
        spamConnection = nil
    end
end

-- Loop principal de detecção
RunService.Heartbeat:Connect(function()
    local playerNearby = isPlayerNearby()
    local ballIsRed = isGameBallRed()
    local ballNearby = isGameBallNearby()
    
    -- Se detectar player próximo E a bola é vermelha E a bola está próxima, ativa o spam
    if playerNearby and ballIsRed and ballNearby then
        if not isSpamming then
            startSpamming()
        end
    -- Se não detectar player próximo OU a bola saiu da distância, desativa o spam
    elseif not playerNearby or not ballNearby then
        if isSpamming then
            stopSpamming()
        end
    end
end)
